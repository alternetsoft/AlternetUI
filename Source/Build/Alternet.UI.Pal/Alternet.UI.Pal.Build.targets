<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <Import Project="Alternet.UI.Pal.Clean.targets"/>

    <!-- ========================================== -->
    <Target Name="BuildManaged">
        <!--<MSBuild Projects="$(Bindings_ManagedProjectFilePath)" Targets="restore" />
        <MSBuild Projects="$(Bindings_ManagedProjectFilePath)"
            Targets="Rebuild"
            Properties="Configuration=$(ManagedBuildConfiguration);OutputPath=$(OutputDirectoryPath)/%(SupportedTargetFrameworkMoniker.Identity);TargetFramework=%(SupportedTargetFrameworkMoniker.Identity)" />

        <ItemGroup>
            <FilesToDelete Include="$(OutputDirectoryPath)\%(SupportedTargetFrameworkMoniker.Identity)\*.deps.json"/>
            <FilesToDelete Include="$(OutputDirectoryPath)\%(SupportedTargetFrameworkMoniker.Identity)\*.pdb"/>
        </ItemGroup> 
        <Delete Files="@(FilesToDelete)"/>-->
    </Target>
    <!-- ========================================== -->
    <ItemGroup Condition="$([MSBuild]::IsOsPlatform('OSX'))">
        <NativeBuildResultFiles Include="$(Bindings_NativeUnixProjectOutputDirectoryPath)/Alternet.UI.Pal.dylib"/>
    </ItemGroup>
    <ItemGroup Condition="$([MSBuild]::IsOsPlatform('Linux'))">
        <NativeBuildResultFiles Include="$(Bindings_NativeUnixProjectOutputDirectoryPath)/Alternet.UI.Pal.so"/>
    </ItemGroup>
    <!-- ========================================== -->
    <ItemGroup Condition="$([MSBuild]::IsOsPlatform('OSX'))">
        <NativeBuildResultFilesDebug Include="$(Bindings_NativeUnixProjectOutputDirectoryPath_Debug)/Alternet.UI.Pal.dylib"/>
    </ItemGroup>
    <ItemGroup Condition="$([MSBuild]::IsOsPlatform('Linux'))">
        <NativeBuildResultFilesDebug Include="$(Bindings_NativeUnixProjectOutputDirectoryPath_Debug)/Alternet.UI.Pal.so"/>
    </ItemGroup>
    <!-- ========================================== -->
    <ItemGroup Condition="$([MSBuild]::IsOsPlatform('OSX'))">
        <NativeBuildResultFilesRelease Include="$(Bindings_NativeUnixProjectOutputDirectoryPath_Release)/Alternet.UI.Pal.dylib"/>
    </ItemGroup>
    <ItemGroup Condition="$([MSBuild]::IsOsPlatform('Linux'))">
        <NativeBuildResultFilesRelease Include="$(Bindings_NativeUnixProjectOutputDirectoryPath_Release)/Alternet.UI.Pal.so"/>
    </ItemGroup>
    <!-- ========================================== -->
    <Target Name="BuildNative_Windows_X86" Condition="$([MSBuild]::IsOsPlatform('Windows'))">
        <Exec Command="&quot;$(CppMsBuildPath)&quot; $(Bindings_NativeVcProjectFilePath) /t:Rebuild /p:Configuration=$(NativeBuildConfiguration);OutDir=$(OutputDirectoryPath_X86);Platform=x86" />
    </Target>
    <!-- ========================================== -->
    <Target Name="BuildNative_Windows_X64" Condition="$([MSBuild]::IsOsPlatform('Windows'))">
        <Exec Command="&quot;$(CppMsBuildPath)&quot; $(Bindings_NativeVcProjectFilePath) /t:Rebuild /p:Configuration=$(NativeBuildConfiguration);OutDir=$(OutputDirectoryPath_X64);Platform=x64" />
    </Target>
    <!-- ========================================== -->
    <Target Name="BuildNative_Windows_CleanupAfterBuild" Condition="$([MSBuild]::IsOsPlatform('Windows'))">
        <ItemGroup>
            <FilesToDelete Include="$(OutputDirectoryPath_X86)\*.exp"/>
            <FilesToDelete Include="$(OutputDirectoryPath_X86)\*.pdb"/>
            <FilesToDelete Include="$(OutputDirectoryPath_X86)\*.iobj"/>
            <FilesToDelete Include="$(OutputDirectoryPath_X86)\*.ipdb"/>
            <FilesToDelete Include="$(OutputDirectoryPath_X86)\*.lib"/>

            <FilesToDelete Include="$(OutputDirectoryPath_X64)\*.exp"/>
            <FilesToDelete Include="$(OutputDirectoryPath_X64)\*.pdb"/>
            <FilesToDelete Include="$(OutputDirectoryPath_X64)\*.iobj"/>
            <FilesToDelete Include="$(OutputDirectoryPath_X64)\*.ipdb"/>
            <FilesToDelete Include="$(OutputDirectoryPath_X64)\*.lib"/>
        </ItemGroup>
        <Delete Files="@(FilesToDelete)"/>
    </Target>
    <!-- ========================================== -->
    <Target Name="BuildNative_Windows" Condition="$([MSBuild]::IsOsPlatform('Windows'))">
        <CallTarget Targets="BuildNative_Windows_X86;BuildNative_Windows_X64;BuildNative_Windows_CleanupAfterBuild" />
    </Target>
    <!-- ========================================== -->
    <Target Name="BuildNative_Unix" Condition="'$(OS)' != 'Windows_NT'">
	   <Message Text="--------------------------------------------------------" Importance="high" />
	   <Message Text="BuildNative_Unix" Importance="high" />

	   <Message Text="Bindings_NativeUnixProjectOutputDirectoryPath:" Importance="high" />
	   <Message Text="$(Bindings_NativeUnixProjectOutputDirectoryPath_Release)" Importance="high" />
	   <Message Text="$(Bindings_NativeUnixProjectOutputDirectoryPath_Debug)" Importance="high" />

	   <Message Text="Bindings_NativeUnixProjectBuildPath:" Importance="high" />
	   <Message Text="$(Bindings_NativeUnixProjectBuildPath)" Importance="high" />

	   <Message Text="OutputDirectoryPath_X64:" Importance="high" />
	   <Message Text="$(OutputDirectoryPath_X64_Release)" Importance="high" />
	   <Message Text="$(OutputDirectoryPath_X64_Debug)" Importance="high" />

        <MakeDir Directories="$(Bindings_NativeUnixProjectOutputDirectoryPath_Release)"/>
        <MakeDir Directories="$(Bindings_NativeUnixProjectOutputDirectoryPath_Debug)"/>

	   <Exec Command="chmod +x $(Bindings_NativeUnixProjectBuildPath)/debug.sh"
              WorkingDirectory="$(Bindings_NativeUnixProjectBuildPath)"/>
        
        <Exec Command="chmod +x $(Bindings_NativeUnixProjectBuildPath)/release.sh"
              WorkingDirectory="$(Bindings_NativeUnixProjectBuildPath)"/>

		<Message Text="--------------------------------------------------------" Importance="high" />
                <Exec Command="$(Bindings_NativeUnixProjectBuildPath)/debug.sh"
              WorkingDirectory="$(Bindings_NativeUnixProjectBuildPath)"/>

        <Copy SourceFiles="@(NativeBuildResultFilesDebug)" DestinationFolder="$(OutputDirectoryPath_X64_Debug)" />
		<Message Text="--------------------------------------------------------" Importance="high" />
         <Exec Command="$(Bindings_NativeUnixProjectBuildPath)/release.sh"
              WorkingDirectory="$(Bindings_NativeUnixProjectBuildPath)"/>
        <Copy SourceFiles="@(NativeBuildResultFilesRelease)" DestinationFolder="$(OutputDirectoryPath_X64_Release)" />
    </Target>
    <!-- ========================================== -->
    <Target Name="BuildNative" DependsOnTargets="BuildNative_Windows;BuildNative_Unix">
    </Target>
    <!-- ========================================== -->
    <Target Name="Build" DependsOnTargets="Clean">
        <CallTarget Targets="BuildManaged;BuildNative" />
    </Target>
    <!-- ========================================== -->
</Project>